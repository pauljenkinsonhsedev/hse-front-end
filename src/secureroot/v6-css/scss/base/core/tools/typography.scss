// ==========================================================================
// TOOLS / #TYPOGRAPHY
// ==========================================================================

//
// These mixins allow us to quickly and consistently generate common text
// patterns such as colours and font-weight
//

@use "../tools/sass-mq" as *;
@use "sass:math";
@use "sass:map";
@use "../settings/all" as *;


// Text colour
// ==========================================================================

//
// Sets the text colour, including a suitable override for print.
//

@mixin hse-text-color {
  color: $hse-text-color;

  @include govuk-media-query($media-type: print) {
    color: $hse-print-text-color;
  }
}


// Normal font weight
// ==========================================================================

//
// @param {Boolean} $important [false] - Whether to mark declarations as
//   `!important`. Generally used to create override classes.
//

@mixin hse-typography-weight-normal($important: false) {
  // ✅ Declarations first
  & {
  font-weight: $hse-font-normal iff($important, !important);
  }
}


// Bold font weight
// ==========================================================================

@mixin hse-typography-weight-bold($important: false) {
  font-weight: $hse-font-bold iff($important, !important);
}


// Line height helper
// ==========================================================================

@function _hse-line-height($line-height, $font-size) {
  @if not math.is-unitless($line-height) and math.unit($line-height) == math.unit($font-size) {
    // Round to 5 decimal places for consistency across implementations
    $ten-to-the-power-five: 100000;
    $line-height: math.div(round(math.div($line-height, $font-size) * $ten-to-the-power-five), $ten-to-the-power-five);
  }

  @return $line-height;
}


// Responsive typography
// ==========================================================================
//
// Takes a 'font map' and outputs responsive font-size and line-height
// declarations for each breakpoint and print.
//

@mixin hse-typography-responsive($size, $override-line-height: false, $important: false) {
  @if not map.has-key($hse-typography-scale, $size) {
    @error "Unknown font size `#{$size}` - expected a point from the typography scale.";
  }

  $font-map: map.get($hse-typography-scale, $size);

  @each $breakpoint, $breakpoint-map in $font-map {
    $font-size: map.get($breakpoint-map, "font-size");
    $font-size-rem: hse-px-to-rem($font-size);

    $line-height: _hse-line-height(
      $line-height: if($override-line-height, $override-line-height, map.get($breakpoint-map, "line-height")),
      $font-size: $font-size
    );

    // Apply !important if requested
    $font-size: $font-size iff($important, !important);
    $font-size-rem: $font-size-rem iff($important, !important);
    $line-height: $line-height iff($important, !important);

    @if $breakpoint == null {
      & {
      font-size: $font-size;
      font-size: $font-size-rem;
      line-height: $line-height;
      }
    } @else if $breakpoint == "print" {
      // ✅ All declarations *inside* nested rule
      @include govuk-media-query($media-type: print) {
        & {
        font-size: $font-size;
        line-height: $line-height;
        }
      }
    } @else {
      // ✅ All declarations *inside* nested rule
      @include govuk-media-query($from: $breakpoint) {
        & {
        font-size: $font-size;
        font-size: $font-size-rem;
        line-height: $line-height;
        }
      }
    }
  }
}


// Font mixin (wrapper)
// ==========================================================================

@mixin hse-font($size, $weight: normal, $line-height: false) {
  // ✅ Weight declarations first
  @if $weight == normal {
    @include hse-typography-weight-normal;
  } @else if $weight == bold {
    @include hse-typography-weight-bold;
  }

  // ✅ Then responsive typography rules
  @if $size {
    @include hse-typography-responsive($size, $override-line-height: $line-height);
  }
}
